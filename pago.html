<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <title>Formulario de Pago</title>
  <link rel="icon" href="img/favicon.png" type="image/png">
  <link rel="stylesheet" href="style.css" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Raleway&display=swap" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
  <style>
    body {
      font-family: 'Raleway', sans-serif;
      background-color: #f9f9f9;
      padding-top: 120px;
    }

    .formulario-pago-container {
      max-width: 960px;
      margin: auto;
      background: white;
      border-radius: 15px;
      box-shadow: 0 0 25px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      display: flex;
      flex-wrap: wrap;
    }

    form {
      flex: 1 1 600px;
      padding: 30px;
    }

    form h3 {
      margin-bottom: 25px;
      font-weight: 700;
    }

    .resumen-pedido {
      width: 320px;
      background: #f8f9fa;
      padding: 30px;
      border-left: 1px solid #ddd;
      display: flex;
      flex-direction: column;
    }

    .resumen-pedido h5 {
      margin-bottom: 20px;
      font-weight: 700;
      border-bottom: 2px solid #333;
      padding-bottom: 8px;
    }

    .producto-resumen {
      display: flex;
      margin-bottom: 15px;
      align-items: center;
      gap: 10px;
    }

    .producto-resumen img {
      width: 70px;
      height: 70px;
      object-fit: cover;
      border-radius: 8px;
      border: 1px solid #ccc;
    }

    .producto-detalles {
      flex: 1;
    }

    .producto-detalles p {
      margin: 0;
      font-size: 0.9rem;
    }

    .producto-total {
      font-weight: 700;
      min-width: 70px;
      text-align: right;
    }

    .resumen-linea {
      display: flex;
      justify-content: space-between;
      margin: 6px 0;
      font-size: 0.95rem;
    }

    .resumen-linea.total {
      font-size: 1.2rem;
      font-weight: 700;
      margin-top: 15px;
      border-top: 2px solid #333;
      padding-top: 10px;
    }

    .section-title {
      font-weight: 600;
      margin-top: 25px;
      margin-bottom: 15px;
      border-bottom: 2px solid #333;
      padding-bottom: 6px;
      font-size: 1.2rem;
    }

    label {
      font-weight: 500;
    }

    input,
    select {
      border-radius: 8px !important;
      border: 1px solid #ccc !important;
      padding: 10px 12px !important;
      font-size: 1rem !important;
    }

    input:focus,
    select:focus {
      border-color: #333 !important;
      box-shadow: 0 0 6px rgba(51, 51, 51, 0.4) !important;
      outline: none !important;
    }

    .form-check-label {
      user-select: none;
      font-weight: 500;
      font-size: 0.95rem;
    }

    button[type="submit"] {
      margin-top: 30px;
      background-color: #333;
      color: white;
      font-weight: 700;
      font-size: 1.15rem;
      border-radius: 10px;
      padding: 14px 0;
      transition: background-color 0.3s ease;
    }

    button[type="submit"]:hover {
      background-color: #555;
    }

    .input-group-text {
      background-color: #eee;
      border-radius: 0 8px 8px 0;
      border-left: 0;
      color: #333;
    }

    /* Iconos tarjetas */
    .tarjetas-icons {
      display: flex;
      gap: 15px;
      margin-bottom: 15px;
      align-items: center;
    }

    .tarjetas-icons img {
      height: 32px;
      user-select: none;
    }

    /* Contenedor para facturación oculto */
    #facturacion-section {
      display: none;
      margin-top: 15px;
      padding: 15px;
      border: 1px solid #ddd;
      border-radius: 10px;
      background: #fafafa;
    }

    /* Botón toggle factura */
    #btn-toggle-factura {
      margin-top: 10px;
      cursor: pointer;
      background: none;
      border: none;
      color: #007bff;
      font-weight: 600;
      padding: 0;
      user-select: none;
    }

    #btn-toggle-factura:hover {
      text-decoration: underline;
    }

    @media (max-width: 991px) {
      .formulario-pago-container {
        flex-direction: column;
      }

      .resumen-pedido {
        width: 100%;
        border-left: none;
        border-top: 1px solid #ddd;
        padding-top: 25px;
        margin-top: 20px;
      }

      form {
        padding: 20px;
      }
    }
  </style>
</head>

<body>
  <div id="header"></div>

  <main>
    <div class="formulario-pago-container" role="main" aria-label="Formulario de pago y resumen de pedido">

      <form id="form-pago" onsubmit="return simularPago()" novalidate>
        <h3>Información del Comprador</h3>

        <div class="mb-3">
          <label for="nombre" class="form-label">Nombre completo <span class="text-danger">*</span></label>
          <input type="text" id="nombre" name="nombre" class="form-control" placeholder="Ej. Juan Pérez" required
            aria-required="true" />
        </div>

        <div class="mb-3">
          <label for="email" class="form-label">Correo electrónico <span class="text-danger">*</span></label>
          <input type="email" id="email" name="email" class="form-control" placeholder="correo@ejemplo.com" required
            aria-required="true" />
        </div>

        <div class="mb-3">
          <label for="telefono" class="form-label">Teléfono (opcional)</label>
          <input type="tel" id="telefono" name="telefono" class="form-control" placeholder="999-999-999" />
        </div>

        <h3 class="section-title">Dirección de Envío</h3>

        <div class="mb-3">
          <label for="direccion" class="form-label">Dirección exacta <span class="text-danger">*</span></label>
          <input type="text" id="direccion" name="direccion" class="form-control" placeholder="Ej. Calle Falsa 123"
            required aria-required="true" />
        </div>

        <div class="mb-3">
          <label for="codigo-postal" class="form-label">Código postal <span class="text-danger">*</span></label>
          <input type="text" id="codigo-postal" name="codigo-postal" class="form-control" placeholder="Ej. 15001"
            required aria-required="true" />
        </div>

        <h3 class="section-title">Método de Pago</h3>

        <div class="tarjetas-icons" aria-label="Métodos de pago aceptados">
          <img src="https://upload.wikimedia.org/wikipedia/commons/5/5e/Visa_Inc._logo.svg" alt="Visa" />
          <img src="https://upload.wikimedia.org/wikipedia/commons/2/2a/Mastercard-logo.svg" alt="MasterCard" />
          <img src="https://upload.wikimedia.org/wikipedia/commons/3/30/American_Express_logo.svg"
            alt="American Express" />
        </div>

        <div class="mb-3">
          <label for="tarjeta" class="form-label">Número de tarjeta <span class="text-danger">*</span></label>
          <div class="input-group">
            <input type="text" id="tarjeta" name="tarjeta" class="form-control" placeholder="**** **** **** ****"
              maxlength="19" required aria-required="true" pattern="\d{13,19}" inputmode="numeric" />
            <span class="input-group-text" title="Pago seguro"><i class="fas fa-lock"></i></span>
          </div>
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="fecha-vencimiento" class="form-label">Fecha de vencimiento <span
                class="text-danger">*</span></label>
            <input type="month" id="fecha-vencimiento" name="fecha-vencimiento" class="form-control" min="" required
              aria-required="true" />
          </div>
          <div class="col-md-6 mb-3">
            <label for="cvv" class="form-label">Código CVV <span class="text-danger">*</span></label>
            <input type="password" id="cvv" name="cvv" class="form-control" maxlength="4" placeholder="***" required
              aria-required="true" pattern="\d{3,4}" inputmode="numeric" />
          </div>
        </div>

        <div class="mb-3">
          <label for="nombre-titular" class="form-label">Nombre del titular <span class="text-danger">*</span></label>
          <input type="text" id="nombre-titular" name="nombre-titular" class="form-control"
            placeholder="Como aparece en la tarjeta" required aria-required="true" />
        </div>

        <button type="button" id="btn-toggle-factura" aria-expanded="false" aria-controls="facturacion-section">¿Quieres
          factura? Haz clic aquí para agregar datos de facturación</button>

        <section id="facturacion-section" aria-hidden="true">
          <h3 class="section-title">Datos de Facturación</h3>

          <div class="mb-3">
            <label for="razon-social" class="form-label">Nombre o razón social</label>
            <input type="text" id="razon-social" name="razon-social" class="form-control"
              placeholder="Ej. Empresa S.A." />
          </div>

          <div class="mb-3">
            <label for="ruc" class="form-label">RUC / NIT / DNI</label>
            <input type="text" id="ruc" name="ruc" class="form-control" placeholder="Ej. 20123456789" />
          </div>

          <div class="mb-3">
            <label for="direccion-facturacion" class="form-label">Dirección de facturación</label>
            <input type="text" id="direccion-facturacion" name="direccion-facturacion" class="form-control"
              placeholder="Ej. Calle Facturación 456" />
          </div>
        </section>

        <div class="form-check mb-3 mt-4">
          <input type="checkbox" class="form-check-input" id="terminos" required aria-required="true" />
          <label class="form-check-label" for="terminos">
            Acepto los <a href="terminos.html" target="_blank" rel="noopener noreferrer">términos y condiciones</a> y la
            <a href="privacidad.html" target="_blank" rel="noopener noreferrer">política de privacidad</a> <span
              class="text-danger">*</span>
          </label>
        </div>

        <button type="submit" class="btn btn-dark w-100" aria-label="Finalizar compra">
          <i class="fas fa-lock me-2"></i> Finalizar compra
        </button>
      </form>

      <aside class="resumen-pedido" aria-label="Resumen del pedido">
        <h5>Resumen del pedido</h5>
        <div id="resumen-items"></div>
        <div class="resumen-linea">
          <span>Subtotal</span>
          <span id="subtotal">S/ 0.00</span>
        </div>
        <div class="resumen-linea">
          <span>Impuestos (18%)</span>
          <span id="impuestos">S/ 0.00</span>
        </div>
        <div class="resumen-linea">
          <span>Envío</span>
          <span class="text-success" id="envio">Gratis</span>
        </div>
        <div class="resumen-linea total">
          <span>Total a pagar</span>
          <span id="total">S/ 0.00</span>
        </div>
      </aside>

    </div>
  </main>

  <div id="footer" class="mt-5"></div>

  <script>
    // Fecha mínima para expiración tarjeta = mes actual
    const fechaVencInput = document.getElementById('fecha-vencimiento');
    if (fechaVencInput) {
      const hoy = new Date();
      let mes = hoy.getMonth() + 1;
      let anio = hoy.getFullYear();
      if (mes < 10) mes = '0' + mes;
      fechaVencInput.min = `${anio}-${mes}`;
    }

    // Toggle sección factura
    const btnToggleFactura = document.getElementById('btn-toggle-factura');
    const facturacionSection = document.getElementById('facturacion-section');

    btnToggleFactura.addEventListener('click', () => {
      const isHidden = facturacionSection.style.display === 'none' || facturacionSection.style.display === '';
      facturacionSection.style.display = isHidden ? 'block' : 'none';
      btnToggleFactura.setAttribute('aria-expanded', isHidden);
      facturacionSection.setAttribute('aria-hidden', !isHidden);
      btnToggleFactura.textContent = isHidden
        ? 'No quiero factura (ocultar datos de facturación)'
        : '¿Quieres factura? Haz clic aquí para agregar datos de facturación';
    });

    // Formato moneda
    function formatoMoneda(num) {
      return 'S/ ' + num.toFixed(2);
    }

    // Cargar resumen del pedido
    function cargarResumen() {
      const resumenItems = document.getElementById('resumen-items');
      const subtotalEl = document.getElementById('subtotal');
      const impuestosEl = document.getElementById('impuestos');
      const envioEl = document.getElementById('envio');
      const totalEl = document.getElementById('total');

      const carrito = JSON.parse(localStorage.getItem("carrito")) || [];

      if (carrito.length === 0) {
        resumenItems.innerHTML = `<p class="text-muted">No hay productos en tu carrito.</p>`;
        subtotalEl.textContent = 'S/ 0.00';
        impuestosEl.textContent = 'S/ 0.00';
        envioEl.textContent = 'Gratis';
        totalEl.textContent = 'S/ 0.00';
        return;
      }

      let subtotal = 0;
      resumenItems.innerHTML = '';

      carrito.forEach(producto => {
        const totalItem = producto.precio * producto.cantidad;
        subtotal += totalItem;

        const divProducto = document.createElement('div');
        divProducto.className = 'producto-resumen';

        const img = document.createElement('img');
        img.src = `img/${producto.IdProducto}.jpg`;
        img.alt = producto.nombre;
        img.onerror = () => { img.src = 'img/placeholder.jpg'; };

        const detalles = document.createElement('div');
        detalles.className = 'producto-detalles';
        detalles.innerHTML = `
          <p><strong>${producto.nombre}</strong></p>
          <p>Cantidad: ${producto.cantidad}</p>
          <p>Precio unitario: ${formatoMoneda(producto.precio)}</p>
        `;

        const totalProducto = document.createElement('div');
        totalProducto.className = 'producto-total';
        totalProducto.textContent = formatoMoneda(totalItem);

        divProducto.appendChild(img);
        divProducto.appendChild(detalles);
        divProducto.appendChild(totalProducto);

        resumenItems.appendChild(divProducto);
      });

      subtotalEl.textContent = formatoMoneda(subtotal);

      const impuestos = subtotal * 0.18; // 18% impuesto
      impuestosEl.textContent = formatoMoneda(impuestos);

      envioEl.textContent = 'Gratis';

      const total = subtotal + impuestos;
      totalEl.textContent = formatoMoneda(total);
    }

    document.addEventListener('DOMContentLoaded', () => {
      fetch("header/header.html").then(res => res.text()).then(data => {
        document.getElementById("header").innerHTML = data;
      });

      fetch("footer/footer.html").then(res => res.text()).then(data => {
        document.getElementById("footer").innerHTML = data;
      });

      cargarResumen();
    });

    function simularPago() {
      const form = document.getElementById('form-pago');

      if (!form.checkValidity()) {
        form.reportValidity();
        return false;
      }

      const numeroPedido = Math.floor(100000 + Math.random() * 900000);
      alert(`Pago simulado con éxito.\n\nNúmero de pedido: #${numeroPedido}\n\n¡Gracias por tu compra!`);

      localStorage.removeItem("carrito");
      window.location.href = "index.html";
      return false;
    }
  </script>
</body>

</html>